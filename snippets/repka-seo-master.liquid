{% comment %}
  ========================================
  REPKA ARTS - MASTER SEO SYSTEM
  God-Level SEO for Artist E-Commerce
  Optimized for Málaga, Costa del Sol
  ========================================

  This snippet handles ALL SEO meta tags, titles, descriptions
  Eliminates duplicates and provides comprehensive optimization
{% endcomment %}

{%- liquid
  # ============================================
  # CONFIGURATION - Artist & Business Info
  # ============================================
  assign artist_name = 'Maryna Riepnova'
  assign business_name = shop.name

  # ============================================
  # PAGE TITLE OPTIMIZATION (50-60 chars)
  # ============================================
  assign seo_title = ''

  # Homepage
  if template == 'index'
    assign seo_title = 'seo.homepage_title' | t
    if seo_title == 'seo.homepage_title'
      assign seo_title = 'Art by Maryna Riepnova | Oil Watercolor Ceramic Málaga'
    endif

    # Product Pages
  elsif template contains 'product' and product
    assign seo_title = product.title

    # Add medium-specific keywords
    if product.tags contains 'watercolor' or product.title contains 'watercolor' or product.title contains 'Watercolor'
      assign seo_title = seo_title | append: ' - Watercolor Art'
    elsif product.tags contains 'oil' or product.title contains 'Oil' or product.title contains 'oil'
      assign seo_title = seo_title | append: ' - Oil Painting'
    elsif product.tags contains 'ceramic' or product.title contains 'Ceramic' or product.title contains 'ceramic'
      assign seo_title = seo_title | append: ' - Ceramic Art'
    elsif product.tags contains 'print' or product.title contains 'Print' or product.title contains 'print'
      assign seo_title = seo_title | append: ' - Art Print'
    elsif product.type == 'Events'
      assign seo_title = seo_title | append: ' - Málaga Event'
    else
      assign seo_title = seo_title | append: ' | Repka Arts'
    endif

    # Ensure 50-60 chars
    if seo_title.size > 60
      assign seo_title = product.title | truncate: 45, '...' | append: ' | Repka Arts'
    endif

    # Collection Pages
  elsif template contains 'collection' and collection
    assign collection_lower = collection.title | downcase

    if collection.handle == 'events'
      assign seo_title = 'Art Events Málaga | Paint & Sip Costa del Sol'
    elsif collection_lower contains 'watercolor' or collection_lower contains 'watercolour'
      assign seo_title = collection.title | append: ' - Watercolor Art Málaga'
    elsif collection_lower contains 'oil'
      assign seo_title = collection.title | append: ' - Oil Paintings Málaga'
    elsif collection_lower contains 'ceramic'
      assign seo_title = collection.title | append: ' - Ceramic Art Spain'
    elsif collection_lower contains 'print'
      assign seo_title = collection.title | append: ' - Art Prints Online'
    else
      assign seo_title = collection.title | append: ' | Repka Arts'
    endif

    # Ensure 50-60 chars
    if seo_title.size > 60
      assign seo_title = collection.title | truncate: 38, '...' | append: ' | Repka Arts'
    elsif seo_title.size < 50
      unless seo_title contains 'Repka Arts'
        assign seo_title = seo_title | append: ' | Repka Arts'
      endunless
    endif

    # Blog/Article Pages
  elsif template contains 'article' and article
    if blog.handle == 'exhibitions'
      assign seo_title = article.title | append: ' - Exhibition Málaga'
    else
      assign seo_title = article.title | append: ' | Art Blog'
    endif

    if seo_title.size > 60
      assign seo_title = article.title | truncate: 45, '...' | append: ' | Blog'
    endif

    # Blog List Pages
  elsif template contains 'blog' and blog
    if blog.handle == 'exhibitions'
      assign seo_title = 'Art Exhibitions Málaga | Repka Arts Gallery Shows'
    else
      assign seo_title = blog.title | append: ' | Repka Arts Blog'
    endif

    # Static Pages (About, Contact, Commission, etc.)
  elsif template == 'page' and page
    # Check for translation key first
    assign translation_key = 'seo.page_' | append: page.handle | append: '_title'
    assign translated_title = translation_key | t

    if translated_title != translation_key
      assign seo_title = translated_title
    else
      # Hardcoded optimized titles for each page
      case page.handle
        when 'about'
          assign seo_title = 'Maryna Riepnova | Oil Watercolor Ceramic Artist Málaga'
        when 'contact'
          assign seo_title = 'Contact Repka Arts | Art Commissions Málaga Spain'
        when 'commission-an-artwork', 'commission', 'commissions'
          assign seo_title = 'Custom Art Commissions | Oil Watercolor Ceramic Prints'
        when 'events'
          assign seo_title = 'Art Events Málaga | Paint & Sip Costa del Sol'
        when 'exhibitions', 'exhibitions-shopify'
          assign seo_title = 'Art Exhibitions Málaga | Repka Arts Gallery Shows'
        when 'artwork-by-medium', 'by-medium', 'medium'
          assign seo_title = 'Art by Medium | Oil Watercolor Ceramic Prints Málaga'
        when 'artwork-by-series', 'by-series', 'series', 'collections'
          assign seo_title = 'Art Collections | Contemporary Paintings Málaga'
        when 'shop', 'store', 'all-products'
          assign seo_title = 'Shop Original Art | Oil Watercolor Ceramic Málaga'
        when 'gallery', 'portfolio'
          assign seo_title = 'Art Gallery Málaga | Original Paintings & Ceramics'
        when 'workshops', 'classes', 'courses'
          assign seo_title = 'Art Workshops Málaga | Painting Classes Costa del Sol'
        when 'faq', 'faqs', 'help'
          assign seo_title = 'FAQ | Art Questions & Shipping Info Málaga'
        when 'privacy-policy', 'privacy'
          assign seo_title = 'Privacy Policy | Repka Arts Málaga'
        when 'terms', 'terms-of-service', 'terms-and-conditions'
          assign seo_title = 'Terms & Conditions | Repka Arts Málaga'
        when 'shipping', 'delivery', 'shipping-policy'
          assign seo_title = 'Shipping & Delivery | Worldwide Art Shipping Málaga'
        when 'refund-policy', 'returns'
          assign seo_title = 'Returns & Refunds | Repka Arts Policy'
        else
          # Generic page fallback with better SEO
          assign seo_title = page.title | append: ' | Repka Arts Málaga'
          if seo_title.size < 50
            assign seo_title = page.title | append: ' - Original Art Málaga Spain'
          elsif seo_title.size > 60
            assign seo_title = page.title | append: ' | Málaga Artist'
          endif
      endcase
    endif

    # Final length check for pages
    if seo_title.size > 60
      assign seo_title = page.title | truncate: 40, '...' | append: ' | Repka Arts'
    endif

    # Cart, Search, 404, etc.
  else
    assign seo_title = page_title
    unless seo_title contains business_name
      assign seo_title = seo_title | append: ' | ' | append: business_name
    endunless
  endif

  # Add pagination info
  if current_page != 1
    assign seo_title = seo_title | append: ' - Page ' | append: current_page
  endif

  # Final safety check on title length
  if seo_title.size > 70
    assign seo_title = seo_title | truncate: 60
  endif

  # ============================================
  # META DESCRIPTION OPTIMIZATION (150-160 chars)
  # ============================================
  assign seo_description = ''

  # Homepage
  if template == 'index'
    assign seo_description = 'seo.homepage_description' | t
    if seo_description == 'seo.homepage_description'
      assign seo_description = 'Original oil paintings, watercolours, ceramics & art prints by Maryna Riepnova in Málaga, Spain. Custom commissions & painting workshops. Worldwide shipping.'
    endif

    # Product Pages
  elsif template contains 'product' and product
    if product.description != blank
      assign seo_description = product.description | strip_html | truncatewords: 25, '...'
    else
      # Generate description from product info
      if product.type == 'Events'
        assign seo_description = 'Join ' | append: product.title | append: ' in Málaga. Art workshop and painting event by Maryna Riepnova. Book your spot for this creative experience.'
      else
        assign seo_description = 'Original ' | append: product.title | append: ' by Maryna Riepnova. Handcrafted in Málaga, Spain. Worldwide shipping available. Unique art for collectors.'
      endif
    endif

    # Ensure length is 150-160 chars
    if seo_description.size > 160
      assign seo_description = seo_description | truncate: 158, '...'
    elsif seo_description.size < 150
      assign seo_description = seo_description | append: ' Discover unique art by Maryna Riepnova in Málaga. Worldwide shipping available.'
      if seo_description.size > 160
        assign seo_description = seo_description | truncate: 158, '...'
      endif
    endif

    # Collection Pages
  elsif template contains 'collection' and collection
    if collection.description != blank
      assign seo_description = collection.description | strip_html | truncatewords: 22, '...'
    else
      assign seo_description = 'Explore ' | append: collection.title | append: ' by Maryna Riepnova. Original artworks, handmade in Málaga, Spain. Contemporary art for collectors and enthusiasts. Worldwide shipping.'
    endif

    # Ensure 150-160 chars for collections
    if seo_description.size > 160
      assign seo_description = seo_description | truncate: 158, '...'
    elsif seo_description.size < 150
      assign seo_description = seo_description | append: ' Browse original art from Málaga, Spain. Shop now.'
      if seo_description.size > 160
        assign seo_description = seo_description | truncate: 158, '...'
      endif
    endif

    # Blog/Article Pages (150-160 chars)
  elsif template contains 'article' and article
    if article.excerpt != blank
      assign seo_description = article.excerpt | strip_html | truncatewords: 22, '...'
    elsif article.content != blank
      assign seo_description = article.content | strip_html | truncatewords: 22, '...'
    else
      if blog.handle == 'exhibitions'
        assign seo_description = 'Art exhibition: ' | append: article.title | append: ' by Maryna Riepnova in Málaga, Spain. Contemporary watercolor, oil & ceramic art gallery show. Visit Costa del Sol.'
      else
        assign seo_description = article.title | append: ' - Art insights, stories & techniques from Repka Arts. Original artwork, painting inspiration and artist updates from Málaga, Spain.'
      endif
    endif

    # Ensure 150-160 chars for blog posts
    if seo_description.size > 160
      assign seo_description = seo_description | truncate: 158, '...'
    elsif seo_description.size < 150
      assign seo_description = seo_description | append: ' Read more art stories from Maryna Riepnova in Málaga, Spain.'
      if seo_description.size > 160
        assign seo_description = seo_description | truncate: 158, '...'
      endif
    endif

    # Static Pages
  elsif template == 'page' and page
    # Check for translation key first
    assign desc_translation_key = 'seo.page_' | append: page.handle | append: '_description'
    assign translated_desc = desc_translation_key | t

    if translated_desc != desc_translation_key
      assign seo_description = translated_desc
    else
      # Hardcoded optimized descriptions (150-160 chars)
      case page.handle
        when 'about'
          assign seo_description = 'Meet Maryna Riepnova, contemporary artist in Málaga, Spain. Oil paintings, watercolours, ceramics & art prints. Custom commissions & workshops Costa del Sol.'
        when 'contact'
          assign seo_description = 'Contact Maryna Riepnova for custom art commissions, exhibition inquiries, or painting workshops in Málaga, Spain. Worldwide shipping. Costa del Sol artist.'
        when 'commission-an-artwork', 'commission', 'commissions'
          assign seo_description = 'Commission custom oil, watercolor, ceramic art or prints by Maryna Riepnova. Personalized artwork for collectors, hotels, and designers. Málaga, Spain.'
        when 'events'
          assign seo_description = 'Join art events and painting workshops in Málaga and Costa del Sol. Plein air sessions, Paint & Sip, creative classes by Maryna Riepnova. All levels welcome.'
        when 'exhibitions', 'exhibitions-shopify'
          assign seo_description = 'View current and past art exhibitions by Maryna Riepnova in Málaga and Costa del Sol. Contemporary watercolor, oil, and ceramic art gallery shows and events.'
        when 'artwork-by-medium', 'by-medium', 'medium'
          assign seo_description = 'Browse original art by medium: oil paintings, watercolours, ceramics & art prints by Maryna Riepnova. Málaga artist. Custom commissions. Worldwide shipping.'
        when 'artwork-by-series', 'by-series', 'series', 'collections'
          assign seo_description = 'Explore art collections and series by Maryna Riepnova. Contemporary paintings and ceramics from Málaga, Spain. Original artwork for collectors worldwide.'
        when 'shop', 'store', 'all-products'
          assign seo_description = 'Shop original oil paintings, watercolours, ceramics & art prints by Maryna Riepnova. Contemporary art from Málaga, Spain. Custom commissions. Worldwide shipping.'
        when 'gallery', 'portfolio'
          assign seo_description = 'Explore the art gallery of Maryna Riepnova in Málaga. Contemporary oil paintings, watercolours & ceramic artworks. Visit our Costa del Sol gallery. Shop online.'
        when 'workshops', 'classes', 'courses'
          assign seo_description = 'Art workshops and painting classes in Málaga by Maryna Riepnova. Learn watercolor, oil painting techniques. Beginner to advanced. Costa del Sol art courses.'
        when 'faq', 'faqs', 'help'
          assign seo_description = 'Frequently asked questions about Repka Arts. Shipping info, custom commissions, art care, framing & delivery. Málaga artist answers. Worldwide shipping available.'
        when 'privacy-policy', 'privacy'
          assign seo_description = 'Privacy policy for Repka Arts online store. How we protect your personal data when purchasing original art from Málaga. Secure checkout. GDPR compliant.'
        when 'terms', 'terms-of-service', 'terms-and-conditions'
          assign seo_description = 'Terms and conditions for Repka Arts. Purchase terms, shipping policies, returns & refunds for original artwork. Málaga artist. Read before ordering art online.'
        when 'shipping', 'delivery', 'shipping-policy'
          assign seo_description = 'Shipping and delivery information for Repka Arts. Worldwide art shipping from Málaga, Spain. Secure packaging, tracking, insurance. Delivery times & costs.'
        when 'refund-policy', 'returns'
          assign seo_description = 'Returns and refund policy for Repka Arts. How to return artwork, refund process, conditions. Original art from Málaga. Customer satisfaction guaranteed.'
        else
          # Use page content or generate with better SEO
          if page.content != blank
            assign seo_description = page.content | strip_html | truncatewords: 22, '...'
          else
            assign seo_description = page.title | append: ' by Repka Arts. Original oil paintings, watercolours & ceramics from Málaga, Spain. Contemporary artist Maryna Riepnova. Worldwide shipping.'
          endif
      endcase
    endif

    # Ensure proper length (150-160 chars)
    if seo_description.size > 160
      assign seo_description = seo_description | truncate: 158, '...'
    elsif seo_description.size < 150 and page.content != blank
      assign seo_description = seo_description | append: ' Visit Repka Arts gallery in Málaga, Spain.'
    elsif seo_description.size < 150
      assign seo_description = seo_description | append: ' Original artwork from Málaga, Spain.'
    endif

    # Blog List Pages (150-160 chars)
  elsif template contains 'blog' and blog
    if blog.handle == 'exhibitions'
      assign seo_description = 'Explore art exhibitions by Maryna Riepnova in Málaga & Costa del Sol. Contemporary watercolor, oil & ceramic gallery shows. View current and past exhibitions.'
    else
      assign seo_description = 'Discover art stories, painting techniques & creative inspiration from Maryna Riepnova. Original artwork insights, artist updates & events from Málaga, Spain.'
    endif

    # Default fallback
  else
    assign seo_description = page_description | default: shop.description
    if seo_description.size > 160
      assign seo_description = seo_description | truncate: 158, '...'
    elsif seo_description.size < 150
      assign seo_description = seo_description | append: ' Discover original art by Maryna Riepnova in Málaga, Spain. Worldwide shipping available.'
      if seo_description.size > 160
        assign seo_description = seo_description | truncate: 158, '...'
      endif
    endif
  endif

  # ============================================
  # CANONICAL URL
  # ============================================
  assign canonical = canonical_url
  if request.page_type == 'password'
    assign canonical = request.origin
  endif

  # ============================================
  # OPEN GRAPH TYPE
  # ============================================
  assign og_type = 'website'
  if template contains 'product'
    assign og_type = 'product'
  elsif template contains 'article'
    assign og_type = 'article'
  endif
-%}

<!-- -- BASIC META TAGS -- -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="theme-color" content="">

<!-- -- TITLE TAG -- -->
<title>{{ seo_title | escape }}</title>

<!-- -- META DESCRIPTION -- -->
<meta name="description" content="{{ seo_description | escape }}">

<!-- -- CANONICAL URL -- -->
<link rel="canonical" href="{{ canonical }}">

<!-- -- ROBOTS META -- -->
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<meta name="googlebot" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

<!-- -- OPEN GRAPH TAGS -- -->
<meta property="og:site_name" content="{{ business_name }}">
<meta property="og:url" content="{{ canonical }}">
<meta property="og:title" content="{{ seo_title | escape }}">
<meta property="og:type" content="{{ og_type }}">
<meta property="og:description" content="{{ seo_description | escape }}">
<meta property="og:locale" content="{{ request.locale.iso_code | replace: '-', '_' }}">

{%- if page_image -%}
  <meta property="og:image" content="https:{{ page_image | image_url: width: 1200 }}">
  <meta property="og:image:secure_url" content="https:{{ page_image | image_url: width: 1200 }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="{{ page_image.height | times: 1200 | divided_by: page_image.width }}">
  <meta property="og:image:alt" content="{{ page_image.alt | default: seo_title | escape }}">
{%- endif -%}

{%- if template contains 'product' and product -%}
  <meta property="og:price:amount" content="{{ product.price | money_without_currency | strip_html | remove: ',' }}">
  <meta property="og:price:currency" content="{{ cart.currency.iso_code }}">
  <meta
    property="product:price:amount"
    content="{{ product.price | money_without_currency | strip_html | remove: ',' }}"
  >
  <meta property="product:price:currency" content="{{ cart.currency.iso_code }}">
  {%- if product.available -%}
    <meta property="product:availability" content="in stock">
  {%- else -%}
    <meta property="product:availability" content="out of stock">
  {%- endif -%}
{%- endif -%}

<!-- -- TWITTER CARD TAGS -- -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ seo_title | escape }}">
<meta name="twitter:description" content="{{ seo_description | escape }}">
{%- if settings.social_twitter_link != blank -%}
  <meta
    name="twitter:site"
    content="{{ settings.social_twitter_link | split: 'twitter.com/' | last | prepend: '@' | remove: ' ' }}"
  >
  <meta
    name="twitter:creator"
    content="{{ settings.social_twitter_link | split: 'twitter.com/' | last | prepend: '@' | remove: ' ' }}"
  >
{%- endif -%}
{%- if page_image -%}
  <meta name="twitter:image" content="https:{{ page_image | image_url: width: 1200 }}">
  <meta name="twitter:image:alt" content="{{ page_image.alt | default: seo_title | escape }}">
{%- endif -%}

<!-- -- LOCATION META TAGS (MÁLAGA, SPAIN) -- -->
<meta name="geo.region" content="ES-AN">
<meta name="geo.placename" content="Málaga">
<meta name="geo.position" content="36.7213;-4.4214">
<meta name="ICBM" content="36.7213, -4.4214">

<!-- -- LANGUAGE & LOCALE -- -->
<meta name="language" content="{{ request.locale.iso_code }}">

<!-- -- ADDITIONAL SEO META -- -->
<meta name="author" content="{{ artist_name }}">
<meta name="creator" content="{{ artist_name }}">
<meta name="publisher" content="{{ business_name }}">
<meta name="copyright" content="© {{ 'now' | date: '%Y' }} {{ business_name }}">
<meta name="revisit-after" content="7 days">
<meta name="classification" content="Art & Collectibles">
<meta name="rating" content="General">
<meta name="distribution" content="Global">

<!-- -- MOBILE META TAGS -- -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="{{ business_name }}">

<!-- -- PINTEREST META -- -->
{%- if template contains 'product' and product and product.featured_image -%}
  <meta property="og:see_also" content="{{ product.url | prepend: shop.url }}">
  <meta name="pinterest:description" content="{{ seo_description | escape }}">
{%- endif -%}

<!-- -- PERFORMANCE HINTS -- -->
<link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
<link rel="dns-prefetch" href="https://cdn.shopify.com">
<link rel="dns-prefetch" href="https://monorail-edge.shopifysvc.com">
