{% doc %}
  @prompt
    I want to pull comments from google customer reviews, I want it to be a carrousel that automatically scrolls, with arrows on the side and a button to add a review that links here:
    
    https://g.page/r/CayzyjuKe2f6EBM/review, Instead of the review date, I want that placeholder to be the city, example: Málaga, Spain, this section needs to be correctly responsive for any resolution
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-google-reviews-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding_top }}px 20px {{ block.settings.section_padding_bottom }}px;
    background-color: {{ block.settings.background_color }};
    position: relative;
    overflow: hidden;
  }

  .ai-google-reviews-container-{{ ai_gen_id }} {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
  }

  .ai-google-reviews-header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 40px;
  }

  .ai-google-reviews-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0 0 16px;
    font-family: var(--font-heading-family);
  }

  .ai-google-reviews-subtitle-{{ ai_gen_id }} {
    font-size: {{ block.settings.subtitle_size }}px;
    color: {{ block.settings.subtitle_color }};
    margin: 0 0 24px;
    font-family: var(--font-body-family);
  }

  .ai-google-reviews-add-button-{{ ai_gen_id }} {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background-color: {{ block.settings.button_bg_color }};
    color: {{ block.settings.button_text_color }};
    text-decoration: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
  }

  .ai-google-reviews-add-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_bg_color }};
    color: {{ block.settings.button_hover_text_color }};
    transform: translateY(-2px);
  }

  .ai-google-reviews-add-button-{{ ai_gen_id }} svg {
    width: 16px;
    height: 16px;
  }

  .ai-google-reviews-carousel-wrapper-{{ ai_gen_id }} {
    position: relative;
    margin-top: 40px;
  }

  .ai-google-reviews-carousel-{{ ai_gen_id }} {
    overflow: hidden;
    position: relative;
    border-radius: {{ block.settings.card_border_radius }}px;
  }

  .ai-google-reviews-track-{{ ai_gen_id }} {
    display: flex;
    transition: transform 0.5s ease-in-out;
    gap: 20px;
  }

  .ai-google-review-card-{{ ai_gen_id }} {
    flex: 0 0 auto;
    background-color: {{ block.settings.card_bg_color }};
    border-radius: {{ block.settings.card_border_radius }}px;
    padding: {{ block.settings.card_padding }}px;
    box-shadow: {% if block.settings.card_shadow_enabled %}0 4px 12px rgba(0, 0, 0, 0.1){% else %}none{% endif %};
    border: {% if block.settings.card_border_enabled %}1px solid {{ block.settings.card_border_color }}{% else %}none{% endif %};
    transition: all 0.3s ease;
    position: relative;
    min-height: 200px;
    display: flex;
    flex-direction: column;
  }

  .ai-google-review-card-{{ ai_gen_id }}:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  }

  .ai-google-review-header-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }

  .ai-google-review-avatar-{{ ai_gen_id }} {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background-color: {{ block.settings.avatar_bg_color }};
    color: {{ block.settings.avatar_text_color }};
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 18px;
    flex-shrink: 0;
  }

  .ai-google-review-info-{{ ai_gen_id }} {
    flex-grow: 1;
    min-width: 0;
  }

  .ai-google-review-name-{{ ai_gen_id }} {
    font-size: {{ block.settings.name_size }}px;
    color: {{ block.settings.name_color }};
    font-weight: 600;
    margin: 0 0 4px;
    font-family: var(--font-heading-family);
    word-wrap: break-word;
  }

  .ai-google-review-city-{{ ai_gen_id }} {
    font-size: {{ block.settings.city_size }}px;
    color: {{ block.settings.city_color }};
    margin: 0;
    font-family: var(--font-body-family);
    word-wrap: break-word;
  }

  .ai-google-review-rating-{{ ai_gen_id }} {
    display: flex;
    gap: 2px;
    margin-bottom: 16px;
  }

  .ai-google-review-star-{{ ai_gen_id }} {
    width: {{ block.settings.star_size }}px;
    height: {{ block.settings.star_size }}px;
    color: {{ block.settings.star_color }};
  }

  .ai-google-review-star-empty-{{ ai_gen_id }} {
    color: {{ block.settings.star_empty_color }};
  }

  .ai-google-review-text-{{ ai_gen_id }} {
    font-size: {{ block.settings.text_size }}px;
    color: {{ block.settings.text_color }};
    line-height: 1.6;
    margin: 0;
    font-family: var(--font-body-family);
    flex-grow: 1;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .ai-google-reviews-nav-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: {{ block.settings.nav_bg_color }};
    color: {{ block.settings.nav_color }};
    border: none;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 2;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  .ai-google-reviews-nav-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.nav_hover_bg_color }};
    color: {{ block.settings.nav_hover_color }};
    transform: translateY(-50%) scale(1.1);
  }

  .ai-google-reviews-nav-{{ ai_gen_id }}:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: translateY(-50%);
  }

  .ai-google-reviews-nav-prev-{{ ai_gen_id }} {
    left: -24px;
  }

  .ai-google-reviews-nav-next-{{ ai_gen_id }} {
    right: -24px;
  }

  .ai-google-reviews-nav-{{ ai_gen_id }} svg {
    width: 20px;
    height: 20px;
  }

  .ai-google-reviews-dots-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 24px;
  }

  .ai-google-reviews-dot-{{ ai_gen_id }} {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: {{ block.settings.dot_color }};
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .ai-google-reviews-dot-{{ ai_gen_id }}.active {
    background-color: {{ block.settings.dot_active_color }};
    transform: scale(1.2);
  }

  .ai-google-reviews-empty-{{ ai_gen_id }} {
    text-align: center;
    padding: 60px 20px;
    color: #666;
    font-style: italic;
  }

  /* Responsive breakpoints */
  
  /* Extra large screens (1400px and up) */
  @media screen and (min-width: 1400px) {
    .ai-google-review-card-{{ ai_gen_id }} {
      width: calc((100% - 40px) / 3);
    }
  }

  /* Large screens (1200px to 1399px) */
  @media screen and (min-width: 1200px) and (max-width: 1399px) {
    .ai-google-review-card-{{ ai_gen_id }} {
      width: calc((100% - 40px) / 3);
    }
  }

  /* Medium-large screens (992px to 1199px) */
  @media screen and (min-width: 992px) and (max-width: 1199px) {
    .ai-google-review-card-{{ ai_gen_id }} {
      width: calc((100% - 20px) / 2);
    }
    
    .ai-google-reviews-track-{{ ai_gen_id }} {
      gap: 16px;
    }
  }

  /* Medium screens (768px to 991px) */
  @media screen and (min-width: 768px) and (max-width: 991px) {
    .ai-google-review-card-{{ ai_gen_id }} {
      width: calc((100% - 20px) / 2);
    }
    
    .ai-google-reviews-track-{{ ai_gen_id }} {
      gap: 16px;
    }
    
    .ai-google-reviews-nav-prev-{{ ai_gen_id }} {
      left: -16px;
    }
    
    .ai-google-reviews-nav-next-{{ ai_gen_id }} {
      right: -16px;
    }
    
    .ai-google-reviews-nav-{{ ai_gen_id }} {
      width: 40px;
      height: 40px;
    }
    
    .ai-google-reviews-nav-{{ ai_gen_id }} svg {
      width: 16px;
      height: 16px;
    }
  }

  /* Small-medium screens (576px to 767px) */
  @media screen and (min-width: 576px) and (max-width: 767px) {
    .ai-google-review-card-{{ ai_gen_id }} {
      width: 100%;
    }
    
    .ai-google-reviews-track-{{ ai_gen_id }} {
      gap: 12px;
    }
    
    .ai-google-reviews-nav-prev-{{ ai_gen_id }} {
      left: -12px;
    }
    
    .ai-google-reviews-nav-next-{{ ai_gen_id }} {
      right: -12px;
    }
    
    .ai-google-reviews-nav-{{ ai_gen_id }} {
      width: 36px;
      height: 36px;
    }
    
    .ai-google-reviews-nav-{{ ai_gen_id }} svg {
      width: 14px;
      height: 14px;
    }
    
    .ai-google-reviews-title-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.title_size }}px * 0.85);
    }
    
    .ai-google-reviews-subtitle-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.subtitle_size }}px * 0.9);
    }
  }

  /* Extra small screens (up to 575px) */
  @media screen and (max-width: 575px) {
    .ai-google-reviews-{{ ai_gen_id }} {
      padding: {{ block.settings.section_padding_top | times: 0.7 }}px 16px {{ block.settings.section_padding_bottom | times: 0.7 }}px;
    }
    
    .ai-google-review-card-{{ ai_gen_id }} {
      width: 100%;
      padding: calc({{ block.settings.card_padding }}px * 0.8);
      min-height: 180px;
    }
    
    .ai-google-reviews-track-{{ ai_gen_id }} {
      gap: 12px;
    }
    
    .ai-google-reviews-nav-prev-{{ ai_gen_id }} {
      left: -8px;
    }
    
    .ai-google-reviews-nav-next-{{ ai_gen_id }} {
      right: -8px;
    }
    
    .ai-google-reviews-nav-{{ ai_gen_id }} {
      width: 32px;
      height: 32px;
    }
    
    .ai-google-reviews-nav-{{ ai_gen_id }} svg {
      width: 12px;
      height: 12px;
    }
    
    .ai-google-reviews-title-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.title_size }}px * 0.75);
    }
    
    .ai-google-reviews-subtitle-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.subtitle_size }}px * 0.85);
    }
    
    .ai-google-review-avatar-{{ ai_gen_id }} {
      width: 40px;
      height: 40px;
      font-size: 16px;
    }
    
    .ai-google-review-name-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.name_size }}px * 0.9);
    }
    
    .ai-google-review-city-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.city_size }}px * 0.9);
    }
    
    .ai-google-review-text-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.text_size }}px * 0.9);
    }
    
    .ai-google-review-star-{{ ai_gen_id }} {
      width: calc({{ block.settings.star_size }}px * 0.85);
      height: calc({{ block.settings.star_size }}px * 0.85);
    }
    
    .ai-google-reviews-add-button-{{ ai_gen_id }} {
      padding: 10px 20px;
      font-size: 13px;
    }
    
    .ai-google-reviews-header-{{ ai_gen_id }} {
      margin-bottom: 32px;
    }
    
    .ai-google-reviews-carousel-wrapper-{{ ai_gen_id }} {
      margin-top: 32px;
    }
  }

  /* Ultra small screens (up to 375px) */
  @media screen and (max-width: 375px) {
    .ai-google-reviews-{{ ai_gen_id }} {
      padding: {{ block.settings.section_padding_top | times: 0.6 }}px 12px {{ block.settings.section_padding_bottom | times: 0.6 }}px;
    }
    
    .ai-google-review-card-{{ ai_gen_id }} {
      padding: calc({{ block.settings.card_padding }}px * 0.7);
      min-height: 160px;
    }
    
    .ai-google-reviews-title-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.title_size }}px * 0.65);
    }
    
    .ai-google-reviews-subtitle-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.subtitle_size }}px * 0.8);
    }
    
    .ai-google-review-name-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.name_size }}px * 0.85);
    }
    
    .ai-google-review-city-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.city_size }}px * 0.85);
    }
    
    .ai-google-review-text-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.text_size }}px * 0.85);
    }
  }

  /* Landscape orientation adjustments */
  @media screen and (max-height: 500px) and (orientation: landscape) {
    .ai-google-reviews-{{ ai_gen_id }} {
      padding: 20px 16px;
    }
    
    .ai-google-reviews-header-{{ ai_gen_id }} {
      margin-bottom: 20px;
    }
    
    .ai-google-reviews-carousel-wrapper-{{ ai_gen_id }} {
      margin-top: 20px;
    }
    
    .ai-google-review-card-{{ ai_gen_id }} {
      min-height: 140px;
    }
  }

  /* High DPI displays */
  @media screen and (-webkit-min-device-pixel-ratio: 2), 
         screen and (min-resolution: 192dpi) {
    .ai-google-reviews-nav-{{ ai_gen_id }} {
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
    }
  }

  /* Reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .ai-google-reviews-track-{{ ai_gen_id }} {
      transition: none;
    }
    
    .ai-google-review-card-{{ ai_gen_id }},
    .ai-google-reviews-nav-{{ ai_gen_id }},
    .ai-google-reviews-dot-{{ ai_gen_id }},
    .ai-google-reviews-add-button-{{ ai_gen_id }} {
      transition: none;
    }
  }

  /* Print styles */
  @media print {
    .ai-google-reviews-nav-{{ ai_gen_id }},
    .ai-google-reviews-dots-{{ ai_gen_id }} {
      display: none;
    }
    
    .ai-google-reviews-track-{{ ai_gen_id }} {
      display: block;
    }
    
    .ai-google-review-card-{{ ai_gen_id }} {
      width: 100%;
      margin-bottom: 20px;
      break-inside: avoid;
    }
  }
{% endstyle %}

<google-reviews-carousel-{{ ai_gen_id }}
  class="ai-google-reviews-{{ ai_gen_id }}"
  data-auto-scroll="{{ block.settings.auto_scroll }}"
  data-scroll-speed="{{ block.settings.auto_scroll_speed }}"
  data-slides-per-view="{{ block.settings.slides_per_view }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-google-reviews-container-{{ ai_gen_id }}">
    <div class="ai-google-reviews-header-{{ ai_gen_id }}">
      {% if block.settings.title != blank %}
        <h2 class="ai-google-reviews-title-{{ ai_gen_id }}">{{ block.settings.title }}</h2>
      {% endif %}
      
      {% if block.settings.subtitle != blank %}
        <p class="ai-google-reviews-subtitle-{{ ai_gen_id }}">{{ block.settings.subtitle }}</p>
      {% endif %}
      
      <a 
        href="https://g.page/r/CayzyjuKe2f6EBM/review" 
        target="_blank" 
        rel="noopener noreferrer"
        class="ai-google-reviews-add-button-{{ ai_gen_id }}"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        {{ block.settings.button_text }}
      </a>
    </div>

    {% assign has_reviews = false %}
    {% for i in (1..6) %}
      {% liquid
        assign name_key = 'review_' | append: i | append: '_name'
        assign text_key = 'review_' | append: i | append: '_text'
        assign rating_key = 'review_' | append: i | append: '_rating'
        assign city_key = 'review_' | append: i | append: '_city'
        
        assign review_name = block.settings[name_key]
        assign review_text = block.settings[text_key]
        assign review_rating = block.settings[rating_key]
        assign review_city = block.settings[city_key]
      %}
      
      {% if review_name != blank and review_text != blank %}
        {% assign has_reviews = true %}
        {% break %}
      {% endif %}
    {% endfor %}

    {% if has_reviews %}
      <div class="ai-google-reviews-carousel-wrapper-{{ ai_gen_id }}">
        <div class="ai-google-reviews-carousel-{{ ai_gen_id }}">
          <div class="ai-google-reviews-track-{{ ai_gen_id }}">
            {% for i in (1..6) %}
              {% liquid
                assign name_key = 'review_' | append: i | append: '_name'
                assign text_key = 'review_' | append: i | append: '_text'
                assign rating_key = 'review_' | append: i | append: '_rating'
                assign city_key = 'review_' | append: i | append: '_city'
                
                assign review_name = block.settings[name_key]
                assign review_text = block.settings[text_key]
                assign review_rating = block.settings[rating_key]
                assign review_city = block.settings[city_key]
              %}
              
              {% if review_name != blank and review_text != blank %}
                <div class="ai-google-review-card-{{ ai_gen_id }}" data-slide="{{ forloop.index0 }}">
                  <div class="ai-google-review-header-{{ ai_gen_id }}">
                    <div class="ai-google-review-avatar-{{ ai_gen_id }}">
                      {% assign name_parts = review_name | split: ' ' %}
                      {% if name_parts.size > 1 %}
                        {{ name_parts[0] | slice: 0 }}{{ name_parts[1] | slice: 0 }}
                      {% else %}
                        {{ review_name | slice: 0, 2 }}
                      {% endif %}
                    </div>
                    <div class="ai-google-review-info-{{ ai_gen_id }}">
                      <h3 class="ai-google-review-name-{{ ai_gen_id }}">{{ review_name }}</h3>
                      {% if review_city != blank %}
                        <p class="ai-google-review-city-{{ ai_gen_id }}">{{ review_city }}</p>
                      {% endif %}
                    </div>
                  </div>
                  
                  <div class="ai-google-review-rating-{{ ai_gen_id }}">
                    {% for star in (1..5) %}
                      <svg 
                        class="ai-google-review-star-{{ ai_gen_id }} {% if star > review_rating %}ai-google-review-star-empty-{{ ai_gen_id }}{% endif %}"
                        xmlns="http://www.w3.org/2000/svg" 
                        viewBox="0 0 24 24" 
                        fill="currentColor"
                      >
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                      </svg>
                    {% endfor %}
                  </div>
                  
                  <p class="ai-google-review-text-{{ ai_gen_id }}">{{ review_text }}</p>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>

        <button class="ai-google-reviews-nav-{{ ai_gen_id }} ai-google-reviews-nav-prev-{{ ai_gen_id }}" aria-label="Previous reviews">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </button>

        <button class="ai-google-reviews-nav-{{ ai_gen_id }} ai-google-reviews-nav-next-{{ ai_gen_id }}" aria-label="Next reviews">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9,6 15,12 9,18"></polyline>
          </svg>
        </button>

        {% if block.settings.show_dots %}
          <div class="ai-google-reviews-dots-{{ ai_gen_id }}"></div>
        {% endif %}
      </div>
    {% else %}
      <div class="ai-google-reviews-empty-{{ ai_gen_id }}">
        <p>Add your Google customer reviews to display them here.</p>
      </div>
    {% endif %}
  </div>
</google-reviews-carousel-{{ ai_gen_id }}>

<script>
  (function() {
    class GoogleReviewsCarousel{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentSlide = 0;
        this.totalSlides = 0;
        this.slidesPerView = 1;
        this.autoScrollInterval = null;
        this.isAutoScrolling = false;
        this.touchStartX = 0;
        this.touchEndX = 0;
      }

      connectedCallback() {
        this.track = this.querySelector('.ai-google-reviews-track-{{ ai_gen_id }}');
        this.slides = this.querySelectorAll('.ai-google-review-card-{{ ai_gen_id }}');
        this.prevBtn = this.querySelector('.ai-google-reviews-nav-prev-{{ ai_gen_id }}');
        this.nextBtn = this.querySelector('.ai-google-reviews-nav-next-{{ ai_gen_id }}');
        this.dotsContainer = this.querySelector('.ai-google-reviews-dots-{{ ai_gen_id }}');
        
        if (!this.slides.length) return;
        
        this.totalSlides = this.slides.length;
        this.setupResponsive();
        this.setupEventListeners();
        this.createDots();
        this.updateCarousel();
        this.setupAutoScroll();
        this.setupTouchEvents();
      }

      setupResponsive() {
        const updateSlidesPerView = () => {
          const width = window.innerWidth;
          if (width >= 1200) {
            this.slidesPerView = Math.min(3, this.totalSlides);
          } else if (width >= 768) {
            this.slidesPerView = Math.min(2, this.totalSlides);
          } else {
            this.slidesPerView = 1;
          }
          this.updateCarousel();
        };

        updateSlidesPerView();
        window.addEventListener('resize', updateSlidesPerView);
      }

      setupEventListeners() {
        this.prevBtn?.addEventListener('click', () => this.prevSlide());
        this.nextBtn?.addEventListener('click', () => this.nextSlide());
        
        this.addEventListener('mouseenter', () => this.pauseAutoScroll());
        this.addEventListener('mouseleave', () => this.resumeAutoScroll());
      }

      setupTouchEvents() {
        this.track.addEventListener('touchstart', (e) => {
          this.touchStartX = e.changedTouches[0].screenX;
          this.pauseAutoScroll();
        });

        this.track.addEventListener('touchend', (e) => {
          this.touchEndX = e.changedTouches[0].screenX;
          this.handleSwipe();
          this.resumeAutoScroll();
        });
      }

      handleSwipe() {
        const swipeThreshold = 50;
        const diff = this.touchStartX - this.touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
          if (diff > 0) {
            this.nextSlide();
          } else {
            this.prevSlide();
          }
        }
      }

      createDots() {
        if (!this.dotsContainer) return;
        
        const maxSlides = Math.max(0, this.totalSlides - this.slidesPerView + 1);
        this.dotsContainer.innerHTML = '';
        
        for (let i = 0; i < maxSlides; i++) {
          const dot = document.createElement('button');
          dot.className = `ai-google-reviews-dot-{{ ai_gen_id }}${i === 0 ? ' active' : ''}`;
          dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
          dot.addEventListener('click', () => this.goToSlide(i));
          this.dotsContainer.appendChild(dot);
        }
      }

      updateCarousel() {
        if (!this.track || !this.slides.length) return;
        
        const slideWidth = 100 / this.slidesPerView;
        const maxSlide = Math.max(0, this.totalSlides - this.slidesPerView);
        
        this.currentSlide = Math.min(this.currentSlide, maxSlide);
        
        this.slides.forEach((slide, index) => {
          slide.style.width = `calc(${slideWidth}% - ${20 * (this.slidesPerView - 1) / this.slidesPerView}px)`;
        });
        
        const translateX = -(this.currentSlide * (100 / this.slidesPerView));
        this.track.style.transform = `translateX(${translateX}%)`;
        
        this.updateNavigation();
        this.updateDots();
      }

      updateNavigation() {
        const maxSlide = Math.max(0, this.totalSlides - this.slidesPerView);
        
        if (this.prevBtn) {
          this.prevBtn.disabled = this.currentSlide === 0;
        }
        
        if (this.nextBtn) {
          this.nextBtn.disabled = this.currentSlide >= maxSlide;
        }
      }

      updateDots() {
        const dots = this.querySelectorAll('.ai-google-reviews-dot-{{ ai_gen_id }}');
        dots.forEach((dot, index) => {
          dot.classList.toggle('active', index === this.currentSlide);
        });
      }

      prevSlide() {
        if (this.currentSlide > 0) {
          this.currentSlide--;
          this.updateCarousel();
        }
      }

      nextSlide() {
        const maxSlide = Math.max(0, this.totalSlides - this.slidesPerView);
        if (this.currentSlide < maxSlide) {
          this.currentSlide++;
          this.updateCarousel();
        } else if (this.isAutoScrolling) {
          this.currentSlide = 0;
          this.updateCarousel();
        }
      }

      goToSlide(slideIndex) {
        const maxSlide = Math.max(0, this.totalSlides - this.slidesPerView);
        this.currentSlide = Math.min(slideIndex, maxSlide);
        this.updateCarousel();
      }

      setupAutoScroll() {
        const autoScroll = this.dataset.autoScroll === 'true';
        const scrollSpeed = parseInt(this.dataset.scrollSpeed) * 1000 || 5000;
        
        if (autoScroll && this.totalSlides > this.slidesPerView) {
          this.isAutoScrolling = true;
          this.autoScrollInterval = setInterval(() => {
            this.nextSlide();
          }, scrollSpeed);
        }
      }

      pauseAutoScroll() {
        if (this.autoScrollInterval) {
          clearInterval(this.autoScrollInterval);
        }
      }

      resumeAutoScroll() {
        if (this.isAutoScrolling) {
          this.setupAutoScroll();
        }
      }

      disconnectedCallback() {
        this.pauseAutoScroll();
        window.removeEventListener('resize', this.setupResponsive);
      }
    }

    customElements.define('google-reviews-carousel-{{ ai_gen_id }}', GoogleReviewsCarousel{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Google customer reviews",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Section content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "What Our Customers Say"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Real reviews from real customers"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Write a Review"
    },
    {
      "type": "header",
      "content": "Carousel settings"
    },
    {
      "type": "checkbox",
      "id": "auto_scroll",
      "label": "Auto scroll",
      "default": true
    },
    {
      "type": "range",
      "id": "auto_scroll_speed",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Auto scroll speed",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show navigation dots",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#212121"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "card_bg_color",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_border_color",
      "label": "Card border color",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "name_color",
      "label": "Customer name color",
      "default": "#212121"
    },
    {
      "type": "color",
      "id": "city_color",
      "label": "City color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Review text color",
      "default": "#212121"
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star color",
      "default": "#ffd700"
    },
    {
      "type": "color",
      "id": "star_empty_color",
      "label": "Empty star color",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "avatar_bg_color",
      "label": "Avatar background",
      "default": "#13308c"
    },
    {
      "type": "color",
      "id": "avatar_text_color",
      "label": "Avatar text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Button colors"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button background",
      "default": "#13308c"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_bg_color",
      "label": "Button hover background",
      "default": "#4e81cc"
    },
    {
      "type": "color",
      "id": "button_hover_text_color",
      "label": "Button hover text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Navigation colors"
    },
    {
      "type": "color",
      "id": "nav_bg_color",
      "label": "Navigation background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "nav_color",
      "label": "Navigation icon color",
      "default": "#212121"
    },
    {
      "type": "color",
      "id": "nav_hover_bg_color",
      "label": "Navigation hover background",
      "default": "#13308c"
    },
    {
      "type": "color",
      "id": "nav_hover_color",
      "label": "Navigation hover icon color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Dot color",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "dot_active_color",
      "label": "Active dot color",
      "default": "#13308c"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 32
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Subtitle size",
      "default": 16
    },
    {
      "type": "range",
      "id": "name_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Customer name size",
      "default": 16
    },
    {
      "type": "range",
      "id": "city_size",
      "min": 10,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "City size",
      "default": 12
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Review text size",
      "default": 14
    },
    {
      "type": "range",
      "id": "star_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Star size",
      "default": 16
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Section padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Section padding bottom",
      "default": 60
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 16,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Card padding",
      "default": 24
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Button border radius",
      "default": 16
    },
    {
      "type": "checkbox",
      "id": "card_shadow_enabled",
      "label": "Card shadow",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "card_border_enabled",
      "label": "Card border",
      "default": false
    },
    {
      "type": "header",
      "content": "Review 1"
    },
    {
      "type": "text",
      "id": "review_1_name",
      "label": "Customer name",
      "default": "María González"
    },
    {
      "type": "text",
      "id": "review_1_city",
      "label": "Customer city",
      "default": "Málaga, Spain"
    },
    {
      "type": "range",
      "id": "review_1_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_1_text",
      "label": "Review text",
      "default": "Excellent service and beautiful artwork! The quality exceeded my expectations and the delivery was very fast. Highly recommend!"
    },
    {
      "type": "header",
      "content": "Review 2"
    },
    {
      "type": "text",
      "id": "review_2_name",
      "label": "Customer name",
      "default": "Carlos Ruiz"
    },
    {
      "type": "text",
      "id": "review_2_city",
      "label": "Customer city",
      "default": "Barcelona, Spain"
    },
    {
      "type": "range",
      "id": "review_2_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_2_text",
      "label": "Review text",
      "default": "Amazing attention to detail and customer service. The artwork looks perfect in my home. Will definitely order again!"
    },
    {
      "type": "header",
      "content": "Review 3"
    },
    {
      "type": "text",
      "id": "review_3_name",
      "label": "Customer name",
      "default": "Ana Martín"
    },
    {
      "type": "text",
      "id": "review_3_city",
      "label": "Customer city",
      "default": "Madrid, Spain"
    },
    {
      "type": "range",
      "id": "review_3_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 4
    },
    {
      "type": "textarea",
      "id": "review_3_text",
      "label": "Review text",
      "default": "Great quality and unique designs. The packaging was excellent and everything arrived in perfect condition."
    },
    {
      "type": "header",
      "content": "Review 4"
    },
    {
      "type": "text",
      "id": "review_4_name",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "review_4_city",
      "label": "Customer city"
    },
    {
      "type": "range",
      "id": "review_4_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_4_text",
      "label": "Review text"
    },
    {
      "type": "header",
      "content": "Review 5"
    },
    {
      "type": "text",
      "id": "review_5_name",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "review_5_city",
      "label": "Customer city"
    },
    {
      "type": "range",
      "id": "review_5_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_5_text",
      "label": "Review text"
    },
    {
      "type": "header",
      "content": "Review 6"
    },
    {
      "type": "text",
      "id": "review_6_name",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "review_6_city",
      "label": "Customer city"
    },
    {
      "type": "range",
      "id": "review_6_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "review_6_text",
      "label": "Review text"
    }
  ],
  "presets": [
    {
      "name": "Google customer reviews"
    }
  ]
}
{% endschema %}