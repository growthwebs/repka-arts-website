{% schema %}
{
  "name": "Custom Cards 2025",
  "tag": "section",
  "class": "custom-cards-2025-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "2025"
    },
    {
      "type": "header",
      "content": "Heading Font"
    },
    {
      "type": "select",
      "id": "heading_font_source",
      "label": "Heading Font Source",
      "options": [
        { "value": "theme", "label": "Use Theme Heading Font" },
        { "value": "custom", "label": "Use Custom Font" }
      ],
      "default": "theme"
    },
    {
      "type": "font_picker",
      "id": "heading_font_custom",
      "label": "Custom Heading Font",
      "default": "helvetica_n4"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 16,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Heading Size",
      "default": 32
    },
    {
      "type": "header",
      "content": "Card Style"
    },
    {
      "type": "range",
      "id": "card_title_size",
      "min": 12,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Card Title Size",
      "default": 20
    },
    {
      "type": "range",
      "id": "card_text_size",
      "min": 12,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Card Text Size",
      "default": 16
    },
    {
      "type": "header",
      "content": "Card Typography"
    },
    {
      "type": "font_picker",
      "id": "card_title_font",
      "label": "Card Title Font",
      "default": "helvetica_n4"
    },
    {
      "type": "font_picker",
      "id": "date_font",
      "label": "Date Font",
      "default": "helvetica_n4"
    },
    {
      "type": "range",
      "id": "date_size",
      "min": 12,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Date Size",
      "default": 16
    },
    {
      "type": "range",
      "id": "entry_text_size",
      "min": 12,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Entry Description Size",
      "default": 16
    },
    {
      "type": "select",
      "id": "entry_layout",
      "label": "Entry Layout",
      "options": [
        { "value": "row", "label": "Horizontal (Date Left)" },
        { "value": "column", "label": "Vertical (Date Top)" }
      ],
      "default": "row"
    },
    {
      "type": "select",
      "id": "card_vertical_alignment",
      "label": "Card Vertical Alignment",
      "options": [
        { "value": "flex-start", "label": "Top" },
        { "value": "center", "label": "Center" },
        { "value": "flex-end", "label": "Bottom" },
        { "value": "space-between", "label": "Space Between" }
      ],
      "default": "space-between"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Card Corner Radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "card_padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Card Padding Top",
      "default": 24
    },
    {
      "type": "range",
      "id": "card_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Card Padding Bottom",
      "default": 24
    },
    {
      "type": "range",
      "id": "card_padding_left",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Card Padding Left",
      "default": 24
    },
    {
      "type": "range",
      "id": "card_padding_right",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Card Padding Right",
      "default": 24
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        { "value": "page", "label": "Page" },
        { "value": "full", "label": "Full" }
      ],
      "default": "page"
    },
    {
      "type": "select",
      "id": "section_height",
      "label": "Section Height",
      "options": [
        { "value": "auto", "label": "Auto" },
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "auto"
    },
    {
      "type": "select",
      "id": "mobile_layout",
      "label": "Mobile Layout",
      "options": [
        { "value": "slider", "label": "Slider (Carousel)" },
        { "value": "collapsible", "label": "Collapsible (Accordion)" }
      ],
      "default": "slider"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 3,
      "label": "Desktop Columns"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Card",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Card Title"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Description (Intro Text)",
          "default": "<p>Intro content.</p>"
        },
        {
          "type": "header",
          "content": "Structured List Entries"
        },
        { "type": "text", "id": "date_1", "label": "Date 1" },
        { "type": "richtext", "id": "text_1", "label": "Text 1" },
        { "type": "text", "id": "date_2", "label": "Date 2" },
        { "type": "richtext", "id": "text_2", "label": "Text 2" },
        { "type": "text", "id": "date_3", "label": "Date 3" },
        { "type": "richtext", "id": "text_3", "label": "Text 3" },
        { "type": "text", "id": "date_4", "label": "Date 4" },
        { "type": "richtext", "id": "text_4", "label": "Text 4" },
        { "type": "text", "id": "date_5", "label": "Date 5" },
        { "type": "richtext", "id": "text_5", "label": "Text 5" },
        { "type": "text", "id": "date_6", "label": "Date 6" },
        { "type": "richtext", "id": "text_6", "label": "Text 6" },
        { "type": "text", "id": "date_7", "label": "Date 7" },
        { "type": "richtext", "id": "text_7", "label": "Text 7" },
        { "type": "text", "id": "date_8", "label": "Date 8" },
        { "type": "richtext", "id": "text_8", "label": "Text 8" },
        { "type": "text", "id": "date_9", "label": "Date 9" },
        { "type": "richtext", "id": "text_9", "label": "Text 9" },
        { "type": "text", "id": "date_10", "label": "Date 10" },
        { "type": "richtext", "id": "text_10", "label": "Text 10" },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "header",
          "content": "Styling"
        },
        {
          "type": "color",
          "id": "background_color",
          "label": "Background Color",
          "default": "#f4f4f4"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text Color",
          "default": "#000000"
        },
        {
          "type": "select",
          "id": "font_family",
          "label": "Font Family Source",
          "options": [
            { "value": "body", "label": "Use Body Font" },
            { "value": "heading", "label": "Use Heading Font" },
            { "value": "custom", "label": "Use Custom Font" }
          ],
          "default": "body"
        },
        {
          "type": "font_picker",
          "id": "custom_font",
          "label": "Custom Font",
          "default": "helvetica_n4"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Cards 2025",
      "blocks": [{ "type": "card" }, { "type": "card" }, { "type": "card" }]
    }
  ]
}
{% endschema %}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Load Custom Heading Font */
  {%- if section.settings.heading_font_source == 'custom' -%}
    {{ section.settings.heading_font_custom | font_face: font_display: 'swap' }}
  {%- endif -%}

  /* Load Custom Card Fonts (Global) */
  {{ section.settings.card_title_font | font_face: font_display: 'swap' }}
  {{ section.settings.date_font | font_face: font_display: 'swap' }}

  /* Custom Block Fonts loop REMOVED to enforce Global Settings */

  /* Scoped CSS for Custom Cards 2025 */
  #shopify-section-{{ section.id }} .cc25-container {
    {%- if section.settings.section_width == 'full' -%}
      max-width: 100%;
      padding-left: 0;
      padding-right: 0;
    {%- else -%}
      max-width: var(--page-width, 1400px);
      margin: 0 auto;
      padding-left: 1.5rem;
      padding-right: 1.5rem;
    {%- endif -%}

    {%- if section.settings.section_height == 'small' -%}
      min-height: 400px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    {%- elsif section.settings.section_height == 'medium' -%}
      min-height: 600px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    {%- elsif section.settings.section_height == 'large' -%}
       min-height: 800px;
       display: flex;
       flex-direction: column;
       justify-content: center;
    {%- endif -%}
  }

  #shopify-section-{{ section.id }} .cc25-heading {
    text-align: center;
    margin-bottom: 2rem;
    font-size: {{ section.settings.heading_size }}px;
    {%- if section.settings.heading_font_source == 'custom' -%}
      font-family: {{ section.settings.heading_font_custom.family }}, {{ section.settings.heading_font_custom.fallback_families }};
      font-style: {{ section.settings.heading_font_custom.style }};
      font-weight: {{ section.settings.heading_font_custom.weight }};
    {%- endif -%}
  }

  /* Desktop Grid */
  #shopify-section-{{ section.id }} .cc25-grid {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
    gap: 2rem;
  }

  /* Card Styling */
  #shopify-section-{{ section.id }} .cc25-card {
    padding-top: {{ section.settings.card_padding_top }}px;
    padding-bottom: {{ section.settings.card_padding_bottom }}px;
    padding-left: {{ section.settings.card_padding_left }}px;
    padding-right: {{ section.settings.card_padding_right }}px;
    border-radius: {{ section.settings.card_border_radius }}px;
    overflow: hidden;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: {{ section.settings.card_vertical_alignment }};
    transition: transform 0.2s ease;
  }

  #shopify-section-{{ section.id }} .cc25-card:hover {
    transform: translateY(-4px);
  }

  #shopify-section-{{ section.id }} .cc25-card img {
    width: 100%;
    height: auto;
    object-fit: cover;
    border-radius: {{ section.settings.card_border_radius | divided_by: 2 }}px;
    margin-bottom: 1rem;
    aspect-ratio: 4/3;
  }

  #shopify-section-{{ section.id }} .cc25-card-title {
    margin-top: 0;
    margin-bottom: 0.5rem;
    font-size: {{ section.settings.card_title_size }}px;
    font-family: {{ section.settings.card_title_font.family }}, {{ section.settings.card_title_font.fallback_families }};
    font-style: {{ section.settings.card_title_font.style }};
    font-weight: {{ section.settings.card_title_font.weight }};
  }

  #shopify-section-{{ section.id }} .cc25-card-text {
    {%- if section.settings.card_vertical_alignment == 'space-between' -%}
      flex-grow: 1;
    {%- else -%}
      flex-grow: 0;
    {%- endif -%}
  }

  #shopify-section-{{ section.id }} .cc25-card-text p {
    font-size: {{ section.settings.card_text_size }}px;
  }

  /* Entries Styling */
  #shopify-section-{{ section.id }} .cc25-entries {
    margin-top: 1rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  #shopify-section-{{ section.id }} .cc25-entry {
    display: flex;
    flex-direction: {{ section.settings.entry_layout }};
    align-items: flex-start;
    gap: 0.5rem;
  }

  #shopify-section-{{ section.id }} .cc25-entry-date {
    font-weight: bold;
    min-width: 80px; /* Aligns rendering */
    font-size: {{ section.settings.date_size }}px;
    font-family: {{ section.settings.date_font.family }}, {{ section.settings.date_font.fallback_families }};
    font-style: {{ section.settings.date_font.style }};
    font-weight: {{ section.settings.date_font.weight }};
    flex-shrink: 0;
  }

  #shopify-section-{{ section.id }} .cc25-entry-text {
    flex-grow: 1;
     font-size: {{ section.settings.entry_text_size }}px;
  }

  #shopify-section-{{ section.id }} .cc25-entry-text p {
      margin: 0; /* Remove default p margin for cleaner lists */
  }

  /* Font Overrides Removed for Global Settings */

  /* Custom fonts are handled inline via specific block ID selectors below */

  /* Mobile Styles */
  @media screen and (max-width: 749px) {
    /* Slider Layout */
    #shopify-section-{{ section.id }} .cc25-grid.mobile-slider {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      gap: 1rem;
      padding-bottom: 1rem;
      -webkit-overflow-scrolling: touch;
      /* Hide scrollbar */
      scrollbar-width: none;
    }
    #shopify-section-{{ section.id }} .cc25-grid.mobile-slider::-webkit-scrollbar {
      display: none;
    }

    #shopify-section-{{ section.id }} .cc25-grid.mobile-slider .cc25-card {
      min-width: 85%; /* Shows part of next card */
      scroll-snap-align: center;
    }

    /* Collapsible Layout */
    #shopify-section-{{ section.id }} .cc25-grid.mobile-collapsible {
      display: block;
    }

    #shopify-section-{{ section.id }} .cc25-grid.mobile-collapsible .cc25-card {
      margin-bottom: 0.5rem;
      padding: 0; /* Reset padding for accordion wrapper */
      background: transparent !important; /* Let details handle bg */
    }

    #shopify-section-{{ section.id }} .cc25-details {
      border-radius: {{ section.settings.card_border_radius }}px;
    }

    #shopify-section-{{ section.id }} .cc25-summary {
      padding: 1rem;
      cursor: pointer;
      list-style: none; /* Hide default marker */
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      font-size: {{ section.settings.card_title_size }}px;
    }

    #shopify-section-{{ section.id }} .cc25-summary::-webkit-details-marker {
      display: none;
    }

    #shopify-section-{{ section.id }} .cc25-summary-icon {
        transition: transform 0.2s;
    }

    #shopify-section-{{ section.id }} .cc25-details[open] .cc25-summary-icon {
        transform: rotate(180deg);
    }

    #shopify-section-{{ section.id }} .cc25-details-content {
      padding: 0 1rem 1rem 1rem;
    }
{%- endstyle -%}

<div class="cc25-container section-{{ section.id }}-padding">
  {%- if section.settings.heading != blank -%}
    <h2 class="cc25-heading {{ section.settings.heading_size }}">{{ section.settings.heading | escape }}</h2>
  {%- endif -%}

  {%- assign mobile_class = 'mobile-' | append: section.settings.mobile_layout -%}

  <div class="cc25-grid {{ mobile_class }}">
    {%- for block in section.blocks -%}
      {%- style -%}
        #block-{{ block.id }} {
          background-color: {{ block.settings.background_color }};
          color: {{ block.settings.text_color }};
        }
        #block-{{ block.id }} a {
           color: {{ block.settings.text_color }};
           text-decoration: underline;
        }

        {%- if block.settings.font_family == 'custom' -%}
          #block-{{ block.id }} .cc25-card-title,
          #block-{{ block.id }} .cc25-card-text,
          #block-{{ block.id }} .cc25-summary span,
          #block-{{ block.id }} .cc25-details-content {
             font-family: {{ block.settings.custom_font.family }}, {{ block.settings.custom_font.fallback_families }};
             font-style: {{ block.settings.custom_font.style }};
             font-weight: {{ block.settings.custom_font.weight }};
          }
        {%- endif -%}
      {%- endstyle -%}

      {%- if section.settings.mobile_layout == 'collapsible' -%}
        <!-- Mobile Collapsible Structure (Only active on mobile via CSS, but rendered always) -->
        <div
          class="cc25-card font-{{ block.settings.font_family }} desktop-only"
          id="block-{{ block.id }}"
          {{ block.shopify_attributes }}
        >
          {%- if block.settings.link != blank -%}
            <a href="{{ block.settings.link }}" class="full-unstyled-link">
          {%- endif -%}
          {%- if block.settings.image != blank -%}
            {{ block.settings.image | image_url: width: 600 | image_tag: loading: 'lazy' }}
          {%- endif -%}
          <h3 class="cc25-card-title">{{ block.settings.title }}</h3>
          <div class="cc25-card-text rte">{{ block.settings.text }}</div>

          <div class="cc25-entries">
            {%- for i in (1..10) -%}
              {%- assign date_key = 'date_' | append: i -%}
              {%- assign text_key = 'text_' | append: i -%}
              {%- assign date_val = block.settings[date_key] -%}
              {%- assign text_val = block.settings[text_key] -%}

              {%- if date_val != blank or text_val != blank -%}
                <div class="cc25-entry">
                  {%- if date_val != blank -%}
                    <div class="cc25-entry-date">{{ date_val }}</div>
                  {%- endif -%}
                  {%- if text_val != blank -%}
                    <div class="cc25-entry-text rte">{{ text_val }}</div>
                  {%- endif -%}
                </div>
              {%- endif -%}
            {%- endfor -%}
          </div>
          {%- if block.settings.link != blank -%}
            </a>
          {%- endif -%}
        </div>

        <details
          class="cc25-details font-{{ block.settings.font_family }}"
          id="block-{{ block.id }}"
          {{ block.shopify_attributes }}
          {% if section.settings.mobile_layout != 'collapsible' %}
            open
          {% endif %}
        >
          <summary class="cc25-summary">
            <span>{{ block.settings.title }}</span>
            <svg
              class="cc25-summary-icon"
              width="12"
              height="8"
              viewBox="0 0 12 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </summary>
          <div class="cc25-details-content">
            {%- if block.settings.image != blank -%}
              {{ block.settings.image | image_url: width: 600 | image_tag: loading: 'lazy', class: 'mb-4' }}
            {%- endif -%}
            <h3 class="cc25-card-title desktop-only-title">{{ block.settings.title }}</h3>
            <div class="cc25-card-text rte">{{ block.settings.text }}</div>
            <div class="cc25-entries">
              {%- for i in (1..10) -%}
                {%- assign date_key = 'date_' | append: i -%}
                {%- assign text_key = 'text_' | append: i -%}
                {%- assign date_val = block.settings[date_key] -%}
                {%- assign text_val = block.settings[text_key] -%}

                {%- if date_val != blank or text_val != blank -%}
                  <div class="cc25-entry">
                    {%- if date_val != blank -%}
                      <div class="cc25-entry-date">{{ date_val }}</div>
                    {%- endif -%}
                    {%- if text_val != blank -%}
                      <div class="cc25-entry-text rte">{{ text_val }}</div>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              {%- endfor -%}
            </div>
            {%- if block.settings.link != blank -%}
              <p><a href="{{ block.settings.link }}">Learn more &rarr;</a></p>
            {%- endif -%}
          </div>
        </details>

      {%- else -%}
        <!-- Standard Card (Slider or Grid) -->
        <div
          class="cc25-card font-{{ block.settings.font_family }}"
          id="block-{{ block.id }}"
          {{ block.shopify_attributes }}
        >
          {%- if block.settings.link != blank -%}
            <a
              href="{{ block.settings.link }}"
              style="text-decoration: none; color: inherit; height: 100%; display: flex; flex-direction: column;"
            >
          {%- endif -%}

          {%- if block.settings.image != blank -%}
            {{ block.settings.image | image_url: width: 600 | image_tag: loading: 'lazy' }}
          {%- endif -%}

          <h3 class="cc25-card-title">{{ block.settings.title }}</h3>
          <div class="cc25-card-text rte">{{ block.settings.text }}</div>

          <div class="cc25-entries">
            {%- for i in (1..10) -%}
              {%- assign date_key = 'date_' | append: i -%}
              {%- assign text_key = 'text_' | append: i -%}
              {%- assign date_val = block.settings[date_key] -%}
              {%- assign text_val = block.settings[text_key] -%}

              {%- if date_val != blank or text_val != blank -%}
                <div class="cc25-entry">
                  {%- if date_val != blank -%}
                    <div class="cc25-entry-date">{{ date_val }}</div>
                  {%- endif -%}
                  {%- if text_val != blank -%}
                    <div class="cc25-entry-text rte">{{ text_val }}</div>
                  {%- endif -%}
                </div>
              {%- endif -%}
            {%- endfor -%}
          </div>

          {%- if block.settings.link != blank -%}
            </a>
          {%- endif -%}
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>
</div>

<style>
  /* CSS Fixes for Helper Logic */
  {% if section.settings.mobile_layout == 'collapsible' %}
    @media screen and (min-width: 750px) {
      /* On Desktop, force details open and hide summary to look like a card */
      #shopify-section-{{ section.id }} details.cc25-details {
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      #shopify-section-{{ section.id }} .cc25-summary {
        display: none;
      }
      #shopify-section-{{ section.id }} .cc25-details-content {
        padding-top: {{ section.settings.card_padding_top }}px;
        padding-bottom: {{ section.settings.card_padding_bottom }}px;
        padding-left: {{ section.settings.card_padding_left }}px;
        padding-right: {{ section.settings.card_padding_right }}px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }
      #shopify-section-{{ section.id }} .desktop-only-title {
        display: block;
      }
    }
    @media screen and (max-width: 749px) {
       /* On Mobile, standard accordion behavior */
      #shopify-section-{{ section.id }} .desktop-only-title {
        display: none; /* Title is in summary */
      }
      #shopify-section-{{ section.id }} .cc25-grid.mobile-collapsible {
          display: flex;
          flex-direction: column;
          gap: 1rem;
      }
    }
  {% endif %}
</style>
